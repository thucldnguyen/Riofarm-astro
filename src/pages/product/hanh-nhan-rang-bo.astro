---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getProductByCode } from '../../data/products';

const product = getProductByCode('hanh-nhan-rang-bo')!;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: product.name,
  image: `https://riofarm.vn${product.image}`,
  description: product.description,
  brand: {
    '@type': 'Brand',
    name: 'Rio Farm',
  },
  offers: {
    '@type': 'Offer',
    availability: 'https://schema.org/InStock',
    seller: {
      '@type': 'Organization',
      name: 'Rio Farm',
    },
  },
};
---

<BaseLayout
  title="H·∫°nh Nh√¢n Rang B∆° | Rio Farm"
  description="H·∫°nh nh√¢n rang b∆° th∆°m ng·∫≠y, gi√†u vitamin E v√† ch·∫•t b√©o t·ªët. ƒê√≥ng g√≥i ti√™u chu·∫©n t·∫°i riofarm.vn, h·∫°n s·ª≠ d·ª•ng 6 th√°ng."
  canonical="https://riofarm.vn/product/hanh-nhan-rang-bo"
  ogType="product"
  ogImage={product.image}
  jsonLd={jsonLd}
>
  <div class="container-large product-shell">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Trang ch·ªß</a><span>‚Ä∫</span>
      <a href="/#san-pham">S·∫£n ph·∫©m</a><span>‚Ä∫</span>
      <span>{product.name}</span>
    </nav>

    <div class="product-content">
      <div>
        <div class="gallery-grid">
          <div class="gallery-main">
            <img
              src={product.gallery[0].image}
              alt={product.gallery[0].alt}
              style="width:100%;border-radius:12px;aspect-ratio:4/3;object-fit:cover;"
              loading="eager"
              id="main-product-img"
            />
          </div>
          {product.gallery.slice(1).map((img) => (
            <img
              src={img.image}
              alt={img.alt}
              style="width:100%;border-radius:8px;aspect-ratio:1;object-fit:cover;cursor:pointer;"
              loading="lazy"
              class="gallery-thumb"
            />
          ))}
        </div>
      </div>

      <div>
        <h1 class="product-name" id="product-name">{product.name}</h1>
        <p class="product-vendor">b·ªüi <strong>{product.vendor}</strong></p>

        <div class="product-price-label">Li√™n h·ªá</div>

        <p class="product-copy">{product.description}</p>

        <!-- Nutrition & Detail Section -->
        <div style="margin:1.5rem 0;border:1px solid #eee;border-radius:10px;overflow:hidden;font-size:0.9rem;">
          <div style="background:var(--gold);padding:0.6rem 1rem;">
            <strong>Th√¥ng tin dinh d∆∞·ª°ng</strong> <span style="font-weight:400;font-size:0.8rem;">(per 28g / ~23 h·∫°t)</span>
          </div>
          <table style="width:100%;border-collapse:collapse;">
            <tbody>
              {[
                ['NƒÉng l∆∞·ª£ng', '170 kcal'],
                ['Ch·∫•t b√©o t·ªïng', '15 g'],
                ['‚Äî Ch·∫•t b√©o kh√¥ng b√£o h√≤a ƒë∆°n', '9.5 g'],
                ['Protein', '6 g'],
                ['Carbohydrate', '6 g'],
                ['Ch·∫•t x∆°', '3.5 g'],
                ['Vitamin E', '7.3 mg (49% DV)'],
                ['Magi√™', '76 mg (18% DV)'],
                ['Canxi', '76 mg (6% DV)'],
                ['Riboflavin (B2)', '0.3 mg (23% DV)'],
              ].map(([label, value], i) => (
                <tr style={`background:${i % 2 === 0 ? '#fafafa' : '#fff'};`}>
                  <td style="padding:0.45rem 1rem;color:#444;">{label}</td>
                  <td style="padding:0.45rem 1rem;text-align:right;font-weight:600;">{value}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <!-- Key Benefits -->
        <ul style="margin:1rem 0 1.5rem;padding-left:1.25rem;line-height:2;font-size:0.9rem;color:#444;">
          <li>üõ°Ô∏è Gi√†u vitamin E nh·∫•t trong c√°c lo·∫°i h·∫°t ‚Äî ch·ªëng oxy h√≥a, b·∫£o v·ªá t·∫ø b√†o</li>
          <li>ü´Ä H·ªó tr·ª£ tim m·∫°ch ‚Äî gi·∫£m LDL cholesterol khi ƒÉn th∆∞·ªùng xuy√™n</li>
          <li>ü¶∑ T·ªët cho x∆∞∆°ng v√† rƒÉng ‚Äî cung c·∫•p canxi v√† magi√™</li>
          <li>üíä H·ªó tr·ª£ ki·ªÉm so√°t ƒë∆∞·ªùng huy·∫øt ‚Äî ch·ªâ s·ªë GI th·∫•p, ph√π h·ª£p ng∆∞·ªùi ti·ªÉu ƒë∆∞·ªùng type 2</li>
          <li>üî• Rang b∆° t·∫°o h∆∞∆°ng th∆°m ƒë·∫∑c tr∆∞ng ‚Äî ngon h∆°n h·∫°nh nh√¢n s·ªëng th√¥ng th∆∞·ªùng</li>
        </ul>

        <div style="margin-bottom:1rem;">
          <label for="qty" class="product-qty-label">S·ªë l∆∞·ª£ng</label>
          <input id="qty" type="number" min="1" value="1" class="product-qty-input" />
        </div>

        <div class="product-actions">
          <button id="add-to-cart" class="btn-secondary" style="width:100%;">Th√™m v√†o gi·ªè</button>
          <button id="buy-now" class="btn-primary" style="width:100%;">Mua ngay</button>
        </div>
        <p id="cart-feedback" style="font-size:0.9rem;color:var(--gold-dark);margin-top:0.75rem;"></p>
      </div>
    </div>
  </div>

  <script type="application/json" id="product-json" set:html={JSON.stringify(product)}></script>
  <script>
    document.querySelectorAll('.gallery-thumb').forEach((thumb) => {
      thumb.addEventListener('click', () => {
        const mainImg = document.getElementById('main-product-img') as HTMLImageElement | null;
        const thumbImg = thumb as HTMLImageElement;
        if (mainImg && thumbImg) {
          mainImg.src = thumbImg.src;
          mainImg.alt = thumbImg.alt;
        }
      });
    });

    const dataEl = document.getElementById('product-json');
    const addBtn = document.getElementById('add-to-cart');
    const buyNowBtn = document.getElementById('buy-now');
    const qtyEl = document.getElementById('qty') as HTMLInputElement | null;
    const feedback = document.getElementById('cart-feedback');
    const productData = dataEl ? JSON.parse(dataEl.textContent || '{}') : null;

    function addToCart(redirectToCheckout = false) {
      if (!window.RioCart || !productData) return;
      const qty = Math.max(1, Number(qtyEl?.value || 1));
      window.RioCart.addToCart(productData, qty);
      if (feedback) feedback.textContent = `ƒê√£ th√™m ${qty} s·∫£n ph·∫©m v√†o gi·ªè h√†ng`;
      if (redirectToCheckout) window.location.href = '/checkout';
    }

    addBtn?.addEventListener('click', () => addToCart(false));
    buyNowBtn?.addEventListener('click', () => addToCart(true));
  </script>
</BaseLayout>
