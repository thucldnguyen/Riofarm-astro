---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getProductByCode } from '../../data/products';

const product = getProductByCode('mit-say')!;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: product.name,
  image: `https://riofarm.vn${product.image}`,
  description: product.description,
  brand: {
    '@type': 'Brand',
    name: 'Rio Farm',
  },
  offers: {
    '@type': 'Offer',
    availability: 'https://schema.org/InStock',
    seller: {
      '@type': 'Organization',
      name: 'Rio Farm',
    },
  },
};
---

<BaseLayout
  title="MÃ­t Sáº¥y | Rio Farm"
  description="MÃ­t sáº¥y 100% nguyÃªn cháº¥t tá»± nhiÃªn. MÃ­t thÃ¡i khÃ´ng Ä‘Æ°á»ng, vá»‹ ngá»t tá»± nhiÃªn. ÄÃ³ng tÃºi cÃ¡c size, giao hÃ ng toÃ n quá»‘c."
  canonical="https://riofarm.vn/product/mit-say"
  ogType="product"
  ogImage={product.image}
  jsonLd={jsonLd}
>
  <div class="container-large product-shell">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Trang chá»§</a><span>â€º</span>
      <a href="/#san-pham">Sáº£n pháº©m</a><span>â€º</span>
      <span>{product.name}</span>
    </nav>

    <div class="product-content">
      <div>
        <div class="gallery-grid">
          <div class="gallery-main">
            <img
              src={product.gallery[0].image}
              alt={product.gallery[0].alt}
              style="width:100%;border-radius:12px;aspect-ratio:4/3;object-fit:cover;"
              loading="eager"
              id="main-product-img"
            />
          </div>
          {product.gallery.slice(1).map((img) => (
            <img
              src={img.image}
              alt={img.alt}
              style="width:100%;border-radius:8px;aspect-ratio:1;object-fit:cover;cursor:pointer;"
              loading="lazy"
              class="gallery-thumb"
            />
          ))}
        </div>
      </div>

      <div>
        <h1 class="product-name" id="product-name">{product.name}</h1>
        <p class="product-vendor">bá»Ÿi <strong>{product.vendor}</strong></p>

        <div class="product-price-label">LiÃªn há»‡</div>

        <p class="product-copy">{product.description}</p>

        <!-- Nutrition & Detail Section -->
        <div style="margin:1.5rem 0;border:1px solid #eee;border-radius:10px;overflow:hidden;font-size:0.9rem;">
          <div style="background:var(--gold);padding:0.6rem 1rem;">
            <strong>ThÃ´ng tin dinh dÆ°á»¡ng</strong> <span style="font-weight:400;font-size:0.8rem;">(per 28g)</span>
          </div>
          <table style="width:100%;border-collapse:collapse;">
            <tbody>
              {[
                ['NÄƒng lÆ°á»£ng', '95 kcal'],
                ['Cháº¥t bÃ©o tá»•ng', '0.5 g'],
                ['Carbohydrate', '23 g'],
                ['â€” ÄÆ°á»ng tá»± nhiÃªn', '15 g'],
                ['Cháº¥t xÆ¡', '1.5 g'],
                ['Protein', '1.5 g'],
                ['Vitamin C', '5.6 mg (6% DV)'],
                ['Vitamin B6', '0.1 mg (6% DV)'],
                ['Kali', '180 mg (4% DV)'],
                ['MagiÃª', '15 mg'],
              ].map(([label, value], i) => (
                <tr style={`background:${i % 2 === 0 ? '#fafafa' : '#fff'};`}>
                  <td style="padding:0.45rem 1rem;color:#444;">{label}</td>
                  <td style="padding:0.45rem 1rem;text-align:right;font-weight:600;">{value}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <!-- Key Benefits -->
        <ul style="margin:1rem 0 1.5rem;padding-left:1.25rem;line-height:2;font-size:0.9rem;color:#444;">
          <li>ğŸŒ¿ KhÃ´ng chiÃªn dáº§u â€” sáº¥y nhiá»‡t giá»¯ nguyÃªn hÆ°Æ¡ng vá»‹ vÃ  dinh dÆ°á»¡ng tá»± nhiÃªn</li>
          <li>ğŸ’Š GiÃ u vitamin C vÃ  B6 â€” há»— trá»£ miá»…n dá»‹ch vÃ  nÄƒng lÆ°á»£ng</li>
          <li>ğŸŠ Kali dá»“i dÃ o â€” tá»‘t cho huyáº¿t Ã¡p vÃ  chá»©c nÄƒng tim</li>
          <li>ğŸ¦  Cháº¥t xÆ¡ tiÃªu hÃ³a â€” há»— trá»£ há»‡ tiÃªu hÃ³a, giáº£m tÃ¡o bÃ³n</li>
          <li>ğŸ˜‹ Vá»‹ ngá»t tá»± nhiÃªn â€” khÃ´ng cáº§n thÃªm Ä‘Æ°á»ng, phÃ¹ há»£p Äƒn váº·t lÃ nh máº¡nh</li>
        </ul>

        <div style="margin-bottom:1rem;">
          <label for="qty" class="product-qty-label">Sá»‘ lÆ°á»£ng</label>
          <input id="qty" type="number" min="1" value="1" class="product-qty-input" />
        </div>

        <div class="product-actions">
          <button id="add-to-cart" class="btn-secondary" style="width:100%;">ThÃªm vÃ o giá»</button>
          <button id="buy-now" class="btn-primary" style="width:100%;">Mua ngay</button>
        </div>
        <p id="cart-feedback" style="font-size:0.9rem;color:var(--gold-dark);margin-top:0.75rem;"></p>
      </div>
    </div>
  </div>

  <script type="application/json" id="product-json" set:html={JSON.stringify(product)}></script>
  <script>
    document.querySelectorAll('.gallery-thumb').forEach((thumb) => {
      thumb.addEventListener('click', () => {
        const mainImg = document.getElementById('main-product-img') as HTMLImageElement | null;
        const thumbImg = thumb as HTMLImageElement;
        if (mainImg && thumbImg) {
          mainImg.src = thumbImg.src;
          mainImg.alt = thumbImg.alt;
        }
      });
    });

    const dataEl = document.getElementById('product-json');
    const addBtn = document.getElementById('add-to-cart');
    const buyNowBtn = document.getElementById('buy-now');
    const qtyEl = document.getElementById('qty') as HTMLInputElement | null;
    const feedback = document.getElementById('cart-feedback');
    const productData = dataEl ? JSON.parse(dataEl.textContent || '{}') : null;

    function addToCart(redirectToCheckout = false) {
      if (!window.RioCart || !productData) return;
      const qty = Math.max(1, Number(qtyEl?.value || 1));
      window.RioCart.addToCart(productData, qty);
      if (feedback) feedback.textContent = `ÄÃ£ thÃªm ${qty} sáº£n pháº©m vÃ o giá» hÃ ng`;
      if (redirectToCheckout) window.location.href = '/checkout';
    }

    addBtn?.addEventListener('click', () => addToCart(false));
    buyNowBtn?.addEventListener('click', () => addToCart(true));
  </script>
</BaseLayout>
