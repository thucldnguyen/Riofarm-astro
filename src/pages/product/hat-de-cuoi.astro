---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getProductByCode } from '../../data/products';

const product = getProductByCode('hat-de-cuoi')!;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: product.name,
  image: `https://riofarm.vn${product.image}`,
  description: product.description,
  brand: {
    '@type': 'Brand',
    name: 'Rio Farm',
  },
  offers: {
    '@type': 'Offer',
    availability: 'https://schema.org/InStock',
    seller: {
      '@type': 'Organization',
      name: 'Rio Farm',
    },
  },
};
---

<BaseLayout
  title="H·∫°t D·∫ª C∆∞·ªùi (Pistachio) | Rio Farm"
  description="H·∫°t d·∫ª c∆∞·ªùi pistachio Rio Farm - Tuy·ªÉn ch·ªçn v√† ƒë√≥ng g√≥i k√≠n kh√≠ t·∫°i L√¢m H√†, L√¢m ƒê·ªìng. Th∆°m b√πi, gi√≤n ngon, gi√†u dinh d∆∞·ª°ng."
  canonical="https://riofarm.vn/product/hat-de-cuoi"
  ogType="product"
  ogImage={product.image}
  jsonLd={jsonLd}
>
  <div class="container-large product-shell">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Trang ch·ªß</a><span>‚Ä∫</span>
      <a href="/#san-pham">S·∫£n ph·∫©m</a><span>‚Ä∫</span>
      <span>{product.name}</span>
    </nav>

    <div class="product-content">
      <div>
        <div class="gallery-grid">
          <div class="gallery-main">
            <img
              src={product.gallery[0].image}
              alt={product.gallery[0].alt}
              style="width:100%;border-radius:12px;aspect-ratio:4/3;object-fit:cover;"
              loading="eager"
              id="main-product-img"
            />
          </div>
          {product.gallery.slice(1).map((img) => (
            <img
              src={img.image}
              alt={img.alt}
              style="width:100%;border-radius:8px;aspect-ratio:1;object-fit:cover;cursor:pointer;"
              loading="lazy"
              class="gallery-thumb"
            />
          ))}
        </div>
      </div>

      <div>
        <h1 class="product-name" id="product-name">{product.name}</h1>
        <p class="product-vendor">b·ªüi <strong>{product.vendor}</strong></p>

        <div class="product-price-label">Li√™n h·ªá</div>

        <p class="product-copy">{product.description}</p>

        <!-- Nutrition & Detail Section -->
        <div style="margin:1.5rem 0;border:1px solid #eee;border-radius:10px;overflow:hidden;font-size:0.9rem;">
          <div style="background:var(--gold);padding:0.6rem 1rem;">
            <strong>Th√¥ng tin dinh d∆∞·ª°ng</strong> <span style="font-weight:400;font-size:0.8rem;">(per 28g / ~49 h·∫°t)</span>
          </div>
          <table style="width:100%;border-collapse:collapse;">
            <tbody>
              {[
                ['NƒÉng l∆∞·ª£ng', '159 kcal'],
                ['Ch·∫•t b√©o t·ªïng', '13 g'],
                ['‚Äî Ch·∫•t b√©o kh√¥ng b√£o h√≤a ƒë∆°n', '6.9 g'],
                ['‚Äî Ch·∫•t b√©o kh√¥ng b√£o h√≤a ƒëa', '4 g'],
                ['Carbohydrate', '8 g'],
                ['Ch·∫•t x∆°', '3 g'],
                ['Protein', '6 g'],
                ['Kali', '291 mg'],
                ['Magi√™', '34 mg'],
                ['Vitamin B6', '0.5 mg (28% DV)'],
                ['ƒê·ªìng', '0.4 mg (44% DV)'],
              ].map(([label, value], i) => (
                <tr style={`background:${i % 2 === 0 ? '#fafafa' : '#fff'};`}>
                  <td style="padding:0.45rem 1rem;color:#444;">{label}</td>
                  <td style="padding:0.45rem 1rem;text-align:right;font-weight:600;">{value}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <!-- Key Benefits -->
        <ul style="margin:1rem 0 1.5rem;padding-left:1.25rem;line-height:2;font-size:0.9rem;color:#444;">
          <li>ü´Ä T·ªët cho tim m·∫°ch ‚Äî gi√†u ch·∫•t b√©o l√†nh m·∫°nh gi√∫p c√¢n b·∫±ng cholesterol</li>
          <li>üí™ H·ªó tr·ª£ c∆° b·∫Øp & mi·ªÖn d·ªãch ‚Äî ngu·ªìn protein th·ª±c v·∫≠t v√† magi√™ d·ªìi d√†o</li>
          <li>üß† TƒÉng c∆∞·ªùng nƒÉng l∆∞·ª£ng n√£o b·ªô ‚Äî vitamin B6 h·ªó tr·ª£ ch·ª©c nƒÉng th·∫ßn kinh</li>
          <li>üåø Gi√†u ch·∫•t ch·ªëng oxy h√≥a ‚Äî lutein v√† zeaxanthin b·∫£o v·ªá m·∫Øt</li>
          <li>‚öñÔ∏è Th√≠ch h·ª£p ƒÉn ki√™ng ‚Äî √≠t calo nh·∫•t trong c√°c lo·∫°i h·∫°t, no l√¢u</li>
        </ul>

        <div style="margin-bottom:1rem;">
          <label for="qty" class="product-qty-label">S·ªë l∆∞·ª£ng</label>
          <input id="qty" type="number" min="1" value="1" class="product-qty-input" />
        </div>

        <div class="product-actions">
          <button id="add-to-cart" class="btn-secondary" style="width:100%;">Th√™m v√†o gi·ªè</button>
          <button id="buy-now" class="btn-primary" style="width:100%;">Mua ngay</button>
        </div>
        <p id="cart-feedback" style="font-size:0.9rem;color:var(--gold-dark);margin-top:0.75rem;"></p>
      </div>
    </div>
  </div>

  <script type="application/json" id="product-json" set:html={JSON.stringify(product)}></script>
  <script>
    document.querySelectorAll('.gallery-thumb').forEach((thumb) => {
      thumb.addEventListener('click', () => {
        const mainImg = document.getElementById('main-product-img') as HTMLImageElement | null;
        const thumbImg = thumb as HTMLImageElement;
        if (mainImg && thumbImg) {
          mainImg.src = thumbImg.src;
          mainImg.alt = thumbImg.alt;
        }
      });
    });

    const dataEl = document.getElementById('product-json');
    const addBtn = document.getElementById('add-to-cart');
    const buyNowBtn = document.getElementById('buy-now');
    const qtyEl = document.getElementById('qty') as HTMLInputElement | null;
    const feedback = document.getElementById('cart-feedback');
    const productData = dataEl ? JSON.parse(dataEl.textContent || '{}') : null;

    function addToCart(redirectToCheckout = false) {
      if (!window.RioCart || !productData) return;
      const qty = Math.max(1, Number(qtyEl?.value || 1));
      window.RioCart.addToCart(productData, qty);
      if (feedback) feedback.textContent = `ƒê√£ th√™m ${qty} s·∫£n ph·∫©m v√†o gi·ªè h√†ng`;
      if (redirectToCheckout) window.location.href = '/checkout';
    }

    addBtn?.addEventListener('click', () => addToCart(false));
    buyNowBtn?.addEventListener('click', () => addToCart(true));
  </script>
</BaseLayout>
