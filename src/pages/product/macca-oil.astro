---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getProductByCode } from '../../data/products';

const product = getProductByCode('macca-oil')!;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: product.name,
  image: `https://riofarm.vn${product.image}`,
  description: product.description,
  brand: { '@type': 'Brand', name: 'Rio Farm' },
  offers: {
    '@type': 'Offer',
    price: product.price,
    priceCurrency: 'VND',
    availability: 'https://schema.org/InStock',
    seller: { '@type': 'Organization', name: 'Rio Farm' },
  },
};
---

<BaseLayout
  title="Dầu Macca | Rio Farm"
  description="Dầu macadamia ép lạnh Rio Farm - Giàu omega, tốt cho tim mạch. Sản xuất tại Lâm Hà, Lâm Đồng."
  canonical="https://riofarm.vn/product/macca-oil"
  ogType="product"
  ogImage={product.image}
  jsonLd={jsonLd}
>
  <div class="container-large product-shell">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Trang chủ</a><span>›</span>
      <span id="product-name">{product.name}</span>
    </nav>

    <div class="product-content">
      <!-- Gallery -->
      <div>
        <img
          src={product.gallery[0].image}
          alt={product.gallery[0].alt}
          style="width:100%;border-radius:12px;aspect-ratio:4/3;object-fit:cover;"
          loading="eager"
        />
      </div>

      <!-- Details -->
      <div>
        <h1 class="product-name">{product.name}</h1>
        <p class="product-vendor">bởi <strong>{product.vendor}</strong></p>

        <div id="product-price-label" class="product-price-label">
          Liên hệ
        </div>

        <p class="product-copy">{product.description}</p>

        <div style="margin-bottom:1rem;">
          <label for="qty" class="product-qty-label">Số lượng</label>
          <input id="qty" type="number" min="1" value="1" class="product-qty-input" />
        </div>
        <div class="product-actions">
          <button id="add-to-cart" class="btn-secondary" style="width:100%;">Thêm vào giỏ</button>
          <button id="buy-now" class="btn-primary" style="width:100%;">Mua ngay</button>
        </div>
        <p id="cart-feedback" style="font-size:0.9rem;color:var(--gold-dark);margin-top:0.75rem;"></p>
      </div>
    </div>

    <div class="blog-content" style="max-width:860px;margin:3rem auto 0;">
      <h2>Dầu Macadamia - Tinh hoa từ thiên nhiên</h2>
      <p>
        Dầu macadamia được ép lạnh từ hạt macadamia tươi ngay tại cơ sở Rio Macca Lâm Hà. Dầu giàu omega-7 (axit palmitoleic)
        - loại axit béo hiếm có khả năng nuôi dưỡng da, chống lão hóa và bảo vệ tim mạch.
      </p>
      <p>
        Dầu macadamia của Rio Farm được sản xuất theo quy trình ép lạnh, đảm bảo giữ lại tối đa dưỡng chất tự nhiên.
        Không sử dụng hóa chất hay chất bảo quản nhân tạo.
      </p>

      <h2>Công dụng của dầu macadamia</h2>
      <ul style="list-style-type:circle;margin-left:1.2rem;">
        <li>Tốt cho tim mạch - giàu axit béo không bão hòa đơn</li>
        <li>Hỗ trợ kiểm soát cân nặng</li>
        <li>Nuôi dưỡng da và tóc</li>
        <li>Chống oxy hóa mạnh</li>
        <li>Thích hợp dùng trong nấu ăn ở nhiệt độ cao</li>
      </ul>

      <div style="text-align:center;margin:1.5rem 0;">
        <img src="/products/macca6.jpg" alt="Dầu macca Rio Farm" style="max-width:400px;width:100%;border-radius:8px;" loading="lazy" />
      </div>
    </div>
    <script type="application/json" id="product-json" set:html={JSON.stringify(product)}></script>
    <script>
      const dataEl = document.getElementById('product-json');
      const addBtn = document.getElementById('add-to-cart');
      const buyNowBtn = document.getElementById('buy-now');
      const qtyEl = document.getElementById('qty');
      const feedback = document.getElementById('cart-feedback');
      const productData = dataEl ? JSON.parse(dataEl.textContent || '{}') : null;

      function addToCart(redirectToCheckout = false) {
        if (!window.RioCart || !productData) return;
        const qty = Math.max(1, Number(qtyEl?.value || 1));
        window.RioCart.addToCart(productData, qty);
        if (feedback) feedback.textContent = `Đã thêm ${qty} sản phẩm vào giỏ hàng`;
        if (redirectToCheckout) window.location.href = '/checkout';
      }

      addBtn?.addEventListener('click', () => addToCart(false));
      buyNowBtn?.addEventListener('click', () => addToCart(true));
    </script>
  </div>
</BaseLayout>
