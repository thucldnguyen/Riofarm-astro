---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getProductByCode } from '../../data/products';

const product = getProductByCode('hat-dieu-rang-muoi')!;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: product.name,
  image: `https://riofarm.vn${product.image}`,
  description: product.description,
  brand: {
    '@type': 'Brand',
    name: 'Rio Farm',
  },
  offers: {
    '@type': 'Offer',
    availability: 'https://schema.org/InStock',
    seller: {
      '@type': 'Organization',
      name: 'Rio Farm',
    },
  },
};
---

<BaseLayout
  title="H·∫°t ƒêi·ªÅu Rang Mu·ªëi | Rio Farm"
  description="H·∫°t ƒëi·ªÅu rang mu·ªëi RIO - 99.9% h·∫°t ƒëi·ªÅu t·ª± nhi√™n, 1% mu·ªëi. ƒê√≥ng h·ªôp 500gr, HSD 6 th√°ng."
  canonical="https://riofarm.vn/product/hat-dieu-rang-muoi"
  ogType="product"
  ogImage={product.image}
  jsonLd={jsonLd}
>
  <div class="container-large product-shell">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Trang ch·ªß</a><span>‚Ä∫</span>
      <a href="/#san-pham">S·∫£n ph·∫©m</a><span>‚Ä∫</span>
      <span>{product.name}</span>
    </nav>

    <div class="product-content">
      <div>
        <div class="gallery-grid">
          <div class="gallery-main">
            <img
              src={product.gallery[0].image}
              alt={product.gallery[0].alt}
              style="width:100%;border-radius:12px;aspect-ratio:4/3;object-fit:cover;"
              loading="eager"
              id="main-product-img"
            />
          </div>
          {product.gallery.slice(1).map((img) => (
            <img
              src={img.image}
              alt={img.alt}
              style="width:100%;border-radius:8px;aspect-ratio:1;object-fit:cover;cursor:pointer;"
              loading="lazy"
              class="gallery-thumb"
            />
          ))}
        </div>
      </div>

      <div>
        <h1 class="product-name" id="product-name">{product.name}</h1>
        <p class="product-vendor">b·ªüi <strong>{product.vendor}</strong></p>

        <div class="product-price-label">Li√™n h·ªá</div>

        <p class="product-copy">{product.description}</p>

        <!-- Nutrition & Detail Section -->
        <div style="margin:1.5rem 0;border:1px solid #eee;border-radius:10px;overflow:hidden;font-size:0.9rem;">
          <div style="background:var(--gold);padding:0.6rem 1rem;">
            <strong>Th√¥ng tin dinh d∆∞·ª°ng</strong> <span style="font-weight:400;font-size:0.8rem;">(per 28g / ~18 h·∫°t)</span>
          </div>
          <table style="width:100%;border-collapse:collapse;">
            <tbody>
              {[
                ['NƒÉng l∆∞·ª£ng', '163 kcal'],
                ['Ch·∫•t b√©o t·ªïng', '13 g'],
                ['‚Äî Ch·∫•t b√©o kh√¥ng b√£o h√≤a ƒë∆°n', '7.7 g'],
                ['Protein', '5 g'],
                ['Carbohydrate', '9 g'],
                ['Ch·∫•t x∆°', '1 g'],
                ['S·∫Øt', '1.9 mg (11% DV)'],
                ['K·∫Ωm', '1.6 mg (15% DV)'],
                ['ƒê·ªìng', '0.6 mg (69% DV)'],
                ['Magi√™', '83 mg (20% DV)'],
                ['Phospho', '168 mg (13% DV)'],
              ].map(([label, value], i) => (
                <tr style={`background:${i % 2 === 0 ? '#fafafa' : '#fff'};`}>
                  <td style="padding:0.45rem 1rem;color:#444;">{label}</td>
                  <td style="padding:0.45rem 1rem;text-align:right;font-weight:600;">{value}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <!-- Key Benefits -->
        <ul style="margin:1rem 0 1.5rem;padding-left:1.25rem;line-height:2;font-size:0.9rem;color:#444;">
          <li>ü©∏ Gi√†u s·∫Øt v√† ƒë·ªìng ‚Äî h·ªó tr·ª£ t·∫°o m√°u, ph√π h·ª£p ph·ª• n·ªØ v√† ng∆∞·ªùi thi·∫øu m√°u</li>
          <li>üí™ Cung c·∫•p magi√™ d·ªìi d√†o ‚Äî gi·∫£m m·ªát m·ªèi, h·ªó tr·ª£ gi·∫•c ng·ªß</li>
          <li>ü¶¥ Phospho v√† k·∫Ωm cho x∆∞∆°ng ch·∫Øc kh·ªèe v√† mi·ªÖn d·ªãch t·ªët</li>
          <li>üß† Ch·ª©a tryptophan ‚Äî ti·ªÅn ch·∫•t serotonin, gi√∫p t√¢m tr·∫°ng t·ªët h∆°n</li>
          <li>üçø Rang mu·ªëi v·ª´a ph·∫£i ‚Äî ƒë·∫≠m ƒë√†, kh√¥ng qu√° m·∫∑n, ƒÉn v·∫∑t kh√¥ng t·ªôi l·ªói</li>
        </ul>

        <div style="margin-bottom:1rem;">
          <label for="qty" class="product-qty-label">S·ªë l∆∞·ª£ng</label>
          <input id="qty" type="number" min="1" value="1" class="product-qty-input" />
        </div>

        <div class="product-actions">
          <button id="add-to-cart" class="btn-secondary" style="width:100%;">Th√™m v√†o gi·ªè</button>
          <button id="buy-now" class="btn-primary" style="width:100%;">Mua ngay</button>
        </div>
        <p id="cart-feedback" style="font-size:0.9rem;color:var(--gold-dark);margin-top:0.75rem;"></p>
      </div>
    </div>
  </div>

  <script type="application/json" id="product-json" set:html={JSON.stringify(product)}></script>
  <script>
    document.querySelectorAll('.gallery-thumb').forEach((thumb) => {
      thumb.addEventListener('click', () => {
        const mainImg = document.getElementById('main-product-img') as HTMLImageElement | null;
        const thumbImg = thumb as HTMLImageElement;
        if (mainImg && thumbImg) {
          mainImg.src = thumbImg.src;
          mainImg.alt = thumbImg.alt;
        }
      });
    });

    const dataEl = document.getElementById('product-json');
    const addBtn = document.getElementById('add-to-cart');
    const buyNowBtn = document.getElementById('buy-now');
    const qtyEl = document.getElementById('qty') as HTMLInputElement | null;
    const feedback = document.getElementById('cart-feedback');
    const productData = dataEl ? JSON.parse(dataEl.textContent || '{}') : null;

    function addToCart(redirectToCheckout = false) {
      if (!window.RioCart || !productData) return;
      const qty = Math.max(1, Number(qtyEl?.value || 1));
      window.RioCart.addToCart(productData, qty);
      if (feedback) feedback.textContent = `ƒê√£ th√™m ${qty} s·∫£n ph·∫©m v√†o gi·ªè h√†ng`;
      if (redirectToCheckout) window.location.href = '/checkout';
    }

    addBtn?.addEventListener('click', () => addToCart(false));
    buyNowBtn?.addEventListener('click', () => addToCart(true));
  </script>
</BaseLayout>
